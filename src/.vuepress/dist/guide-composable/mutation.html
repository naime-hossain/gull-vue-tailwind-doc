<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mutations | Aatrox</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.png">
    <meta name="description" content="🚀 Production Ready, Carefully Crafted, Extensive Vue 3 Tailwind Admin Template 🚀">
    
    <link rel="preload" href="/assets/css/0.styles.093e62d5.css" as="style"><link rel="preload" href="/assets/js/app.d6060d8c.js" as="script"><link rel="preload" href="/assets/js/2.d347fc36.js" as="script"><link rel="preload" href="/assets/js/38.9bfe8e62.js" as="script"><link rel="preload" href="/assets/js/4.3bfcd1eb.js" as="script"><link rel="prefetch" href="/assets/js/10.07f3dd6a.js"><link rel="prefetch" href="/assets/js/11.842fc523.js"><link rel="prefetch" href="/assets/js/12.e785caa3.js"><link rel="prefetch" href="/assets/js/13.fdb12f07.js"><link rel="prefetch" href="/assets/js/14.9144e1c8.js"><link rel="prefetch" href="/assets/js/15.bace1ae4.js"><link rel="prefetch" href="/assets/js/16.891324fc.js"><link rel="prefetch" href="/assets/js/17.c9794947.js"><link rel="prefetch" href="/assets/js/18.24a08ac1.js"><link rel="prefetch" href="/assets/js/19.27df5ea4.js"><link rel="prefetch" href="/assets/js/20.34c2dde6.js"><link rel="prefetch" href="/assets/js/21.ef09050c.js"><link rel="prefetch" href="/assets/js/22.f992592b.js"><link rel="prefetch" href="/assets/js/23.8f880339.js"><link rel="prefetch" href="/assets/js/24.87282a3d.js"><link rel="prefetch" href="/assets/js/25.6c4d6bd1.js"><link rel="prefetch" href="/assets/js/26.59e51c9f.js"><link rel="prefetch" href="/assets/js/27.eebe1132.js"><link rel="prefetch" href="/assets/js/28.00be216d.js"><link rel="prefetch" href="/assets/js/29.4d6b9e7e.js"><link rel="prefetch" href="/assets/js/3.df915ef7.js"><link rel="prefetch" href="/assets/js/30.2476a4cb.js"><link rel="prefetch" href="/assets/js/31.2722c49a.js"><link rel="prefetch" href="/assets/js/32.7112e7af.js"><link rel="prefetch" href="/assets/js/33.1776a5c1.js"><link rel="prefetch" href="/assets/js/34.30049684.js"><link rel="prefetch" href="/assets/js/35.c161bbdf.js"><link rel="prefetch" href="/assets/js/36.c0f3b0c2.js"><link rel="prefetch" href="/assets/js/37.f701f25d.js"><link rel="prefetch" href="/assets/js/39.0a067b54.js"><link rel="prefetch" href="/assets/js/40.aaccb5b2.js"><link rel="prefetch" href="/assets/js/41.8406db25.js"><link rel="prefetch" href="/assets/js/42.d640c84a.js"><link rel="prefetch" href="/assets/js/43.167bce97.js"><link rel="prefetch" href="/assets/js/44.dbad1001.js"><link rel="prefetch" href="/assets/js/45.7c12bc58.js"><link rel="prefetch" href="/assets/js/46.72e2e644.js"><link rel="prefetch" href="/assets/js/47.95923bad.js"><link rel="prefetch" href="/assets/js/48.e3130295.js"><link rel="prefetch" href="/assets/js/49.41a3e160.js"><link rel="prefetch" href="/assets/js/5.c754c5c1.js"><link rel="prefetch" href="/assets/js/50.9956d438.js"><link rel="prefetch" href="/assets/js/51.acf07990.js"><link rel="prefetch" href="/assets/js/52.9e942a6f.js"><link rel="prefetch" href="/assets/js/53.45c49bfc.js"><link rel="prefetch" href="/assets/js/54.0a600b12.js"><link rel="prefetch" href="/assets/js/55.eec77fcb.js"><link rel="prefetch" href="/assets/js/56.572c97d8.js"><link rel="prefetch" href="/assets/js/57.abef7689.js"><link rel="prefetch" href="/assets/js/58.a721ebe3.js"><link rel="prefetch" href="/assets/js/59.5e36d5dc.js"><link rel="prefetch" href="/assets/js/6.7023f416.js"><link rel="prefetch" href="/assets/js/60.3a779059.js"><link rel="prefetch" href="/assets/js/7.3722245b.js"><link rel="prefetch" href="/assets/js/8.6417a644.js"><link rel="prefetch" href="/assets/js/9.e0f2787c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.093e62d5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Aatrox</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">
  Getting started
</a></li></ul></div></div><div class="nav-item"><a href="https://aatrox-vue.netlify.app/landingpage" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/Akryum/vue-apollo" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Guide" class="dropdown-title"><span class="title">Guide</span> <span class="arrow down"></span></button> <button type="button" aria-label="Guide" class="mobile-dropdown-title"><span class="title">Guide</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">
  Getting started
</a></li></ul></div></div><div class="nav-item"><a href="https://aatrox-vue.netlify.app/landingpage" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Demo
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/Akryum/vue-apollo" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Composition API Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide-composable/" aria-current="page" class="sidebar-link">Introduction</a></li><li><a href="/guide-composable/setup.html" class="sidebar-link">Setup</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Fetching data</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide-composable/query.html" class="sidebar-link">Queries</a></li><li><a href="/guide-composable/mutation.html" aria-current="page" class="active sidebar-link">Mutations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide-composable/mutation.html#executing-a-mutation" class="sidebar-link">Executing a mutation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide-composable/mutation.html#options" class="sidebar-link">Options</a></li><li class="sidebar-sub-header"><a href="/guide-composable/mutation.html#variables" class="sidebar-link">Variables</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide-composable/mutation.html#updating-the-cache-after-a-mutation" class="sidebar-link">Updating the cache after a mutation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide-composable/mutation.html#updating-a-single-existing-entity" class="sidebar-link">Updating a single existing entity</a></li><li class="sidebar-sub-header"><a href="/guide-composable/mutation.html#making-all-other-cache-updates" class="sidebar-link">Making all other cache updates</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide-composable/mutation.html#mutation-state" class="sidebar-link">Mutation state</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide-composable/mutation.html#loading" class="sidebar-link">Loading</a></li><li class="sidebar-sub-header"><a href="/guide-composable/mutation.html#error" class="sidebar-link">Error</a></li></ul></li><li class="sidebar-sub-header"><a href="/guide-composable/mutation.html#event-hooks" class="sidebar-link">Event hooks</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide-composable/mutation.html#ondone" class="sidebar-link">onDone</a></li><li class="sidebar-sub-header"><a href="/guide-composable/mutation.html#onerror" class="sidebar-link">onError</a></li></ul></li></ul></li><li><a href="/guide-composable/subscription.html" class="sidebar-link">Subscriptions</a></li><li><a href="/guide-composable/pagination.html" class="sidebar-link">Pagination</a></li><li><a href="/guide-composable/fragments.html" class="sidebar-link">Using fragments</a></li><li><a href="/guide-composable/error-handling.html" class="sidebar-link">Error handling</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mutations"><a href="#mutations" class="header-anchor">#</a> Mutations</h1> <p>Now that's we've learned <a href="./query">how to fetch data</a>, the next logical step is to study how to update data using <strong>mutations</strong>. If you need a refresher on mutations or GraphQL documents, read <a href="https://graphql.org/learn/queries/#mutations" target="_blank" rel="noopener noreferrer">this guide<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="executing-a-mutation"><a href="#executing-a-mutation" class="header-anchor">#</a> Executing a mutation</h2> <p>The <code>useMutation</code> composition function is the main way of setting up mutations in Vue components.</p> <p>Start by importing it in your component:</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> useMutation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/apollo-composable'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Your data &amp; logic here...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>You can use <code>useMutation</code> in your <code>setup</code> option by passing it a GraphQL document as the first parameter and retrieve the <code>mutate</code> function:</p> <div class="language-vue extra-class"><div class="highlight-lines"><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br></div><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> useMutation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/apollo-composable'</span>
<span class="token keyword">import</span> gql <span class="token keyword">from</span> <span class="token string">'graphql-tag'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> mutate <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      mutation sendMessage ($input: SendMessageInput!) {
        sendMessage (input: $input) {
          id
        }
      }
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>It's generally a good idea to rename the <code>mutate</code> function into something more explicit:</p> <div class="language-vue extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br></div><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> useMutation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/apollo-composable'</span>
<span class="token keyword">import</span> gql <span class="token keyword">from</span> <span class="token string">'graphql-tag'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      mutation sendMessage ($input: SendMessageInput!) {
        sendMessage (input: $input) {
          id
        }
      }
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>We can now use it in our template by passing variables to <code>mutate</code> (now called <code>sendMessage</code>):</p> <div class="language-vue extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> useMutation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/apollo-composable'</span>
<span class="token keyword">import</span> gql <span class="token keyword">from</span> <span class="token string">'graphql-tag'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      mutation sendMessage ($text: String!) {
        sendMessage (text: $text) {
          id
        }
      }
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      sendMessage<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessage({ text: <span class="token punctuation">'</span>Hello<span class="token punctuation">'</span> })<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      Send message
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>We can call <code>sendMessage</code> in our JavaScript code too.</p> <h3 id="options"><a href="#options" class="header-anchor">#</a> Options</h3> <p>We can pass options to <code>useMutation</code> as the 2nd parameter:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  mutation sendMessage ($text: String!) {
    sendMessage (text: $text) {
      id
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  fetchPolicy<span class="token operator">:</span> <span class="token string">'no-cache'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>It can also be a function that returns the options object. It will be automatically called when <code>mutate</code> (here <code>sendMessage</code>) is called, before executing the mutation on Apollo Client:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br></div><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  mutation sendMessage ($text: String!) {
    sendMessage (text: $text) {
      id
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  fetchPolicy<span class="token operator">:</span> <span class="token string">'no-cache'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>See the <a href="../api/use-mutation">API Reference</a> for all the possible options.</p> <h3 id="variables"><a href="#variables" class="header-anchor">#</a> Variables</h3> <p>There are two ways of passing a variables object to the mutation.</p> <p>We already saw the first one: we can pass the variables when calling the <code>mutate</code> function:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  mutation sendMessage ($text: String!) {
    sendMessage (text: $text) {
      id
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  text<span class="token operator">:</span> <span class="token string">'Hello'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>The other way is to put them in the <code>options</code>:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><div class="highlighted"> </div><br></div><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  mutation sendMessage ($text: String!) {
    sendMessage (text: $text) {
      id
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  variables<span class="token operator">:</span> <span class="token punctuation">{</span>
    text<span class="token operator">:</span> <span class="token string">'Hello'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>Most of the time, our variables will be dynamic though. Let's say we have a <code>text</code> ref that will be updated by the user:</p> <div class="language-js extra-class"><div class="highlight-lines"><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  mutation sendMessage ($text: String!) {
    sendMessage (text: $text) {
      id
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  variables<span class="token operator">:</span> <span class="token punctuation">{</span>
    text<span class="token operator">:</span> text<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>This will not work! Indeed, we set up the variables only once, so <code>variables.text</code> will forever be an empty string even if the <code>text</code> ref is changed later.</p> <p>The solution is to use the options function syntax, so it is called each time the mutation is executed:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><div class="highlighted"> </div><br><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  mutation sendMessage ($text: String!) {
    sendMessage (text: $text) {
      id
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  variables<span class="token operator">:</span> <span class="token punctuation">{</span>
    text<span class="token operator">:</span> text<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>Our component now looks like:</p> <div class="language-vue extra-class"><div class="highlight-lines"><br><div class="highlighted"> </div><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><div class="highlighted"> </div><br><br><br><br><br></div><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useMutation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/apollo-composable'</span>
<span class="token keyword">import</span> gql <span class="token keyword">from</span> <span class="token string">'graphql-tag'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

    <span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      mutation sendMessage ($text: String!) {
        sendMessage (text: $text) {
          id
        }
      }
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      variables<span class="token operator">:</span> <span class="token punctuation">{</span>
        text<span class="token operator">:</span> text<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      text<span class="token punctuation">,</span>
      sendMessage<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Enter a message<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessage()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      Send message
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>The variables objects will be merged if you specify one in the options and one when calling <code>mutate</code>:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> text <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  mutation sendMessage ($text: String!, $subject: String!) {
    sendMessage (text: $text, subject: $subject) {
      id
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  variables<span class="token operator">:</span> <span class="token punctuation">{</span>
    subject<span class="token operator">:</span> <span class="token string">'Message sent from my app'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  text<span class="token operator">:</span> text<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="updating-the-cache-after-a-mutation"><a href="#updating-the-cache-after-a-mutation" class="header-anchor">#</a> Updating the cache after a mutation</h2> <p>When you execute a mutation, you modify data on your server. In most case, this data was also in your client cache, so you might need to update it to reflect the changes made by the mutation. This depends on whether the mutation updates a single existing entity.</p> <h3 id="updating-a-single-existing-entity"><a href="#updating-a-single-existing-entity" class="header-anchor">#</a> Updating a single existing entity</h3> <p>In this case, Apollo Client will automatically update the entity in the cache, using the data returned by the mutation execution. It will use the <code>id</code> of the modified entity alongside its <code>__typename</code> to find it in the cache and update the modified fields.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> editMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  mutation editMessage ($id: ID!, $text: String!) {
    editMessage (id: $id, text: $text) {
      id
      text
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  variables<span class="token operator">:</span> <span class="token punctuation">{</span>
    id<span class="token operator">:</span> <span class="token string">'abc'</span><span class="token punctuation">,</span>
    text<span class="token operator">:</span> <span class="token string">'Hi! How is it going?'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">editMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>In this example, if we already loaded the list of messages containing the one with <code>id</code> equals to <code>abc</code>, the mutation will search the cache for it and update its <code>text</code> field automatically.</p> <h3 id="making-all-other-cache-updates"><a href="#making-all-other-cache-updates" class="header-anchor">#</a> Making all other cache updates</h3> <p>If a mutation modifies multiple entities, or if it creates or deletes one or many entities, the Apollo Client will <em>not</em> automatically update the cache to reflect the changes made by the mutation. Instead, you should update the cache using an <code>update</code> function in the options.</p> <p>The purpose of this <code>update</code> function is to modify your cached data to match the changes made by the mutation on the server.</p> <p>For example, our <code>sendMessage</code> mutation should add the new message to our cache:</p> <div class="language-vue extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> useQuery<span class="token punctuation">,</span> useResult<span class="token punctuation">,</span> useMutation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/apollo-composable'</span>
<span class="token keyword">import</span> gql <span class="token keyword">from</span> <span class="token string">'graphql-tag'</span>

<span class="token keyword">const</span> <span class="token constant">MESSAGES</span> <span class="token operator">=</span> gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  query getMessages {
    messages {
      id
      text
    }
  }
</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Messages list</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> result <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token constant">MESSAGES</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> messages <span class="token operator">=</span> <span class="token function">useResult</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment">// Send a new message</span>
    <span class="token keyword">const</span> newMessage <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      mutation sendMessage ($text: String!) {
        sendMessage (text: $text) {
          id
          text
        }
      }
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      variables<span class="token operator">:</span> <span class="token punctuation">{</span>
        text<span class="token operator">:</span> newMessage<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">cache<span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token punctuation">{</span> sendMessage <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">readQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query<span class="token operator">:</span> <span class="token constant">MESSAGES</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        data<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sendMessage<span class="token punctuation">)</span>
        cache<span class="token punctuation">.</span><span class="token function">writeQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query<span class="token operator">:</span> <span class="token constant">MESSAGES</span><span class="token punctuation">,</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      messages<span class="token punctuation">,</span>
      newMessage<span class="token punctuation">,</span>
      sendMessage<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>newMessage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@keyup.enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>
      sendMessage()
      newMessage = <span class="token punctuation">'</span><span class="token punctuation">'</span>
    <span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>messages<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message of messages<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        {{ message.text }}
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Let's focus on the mutation:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  mutation sendMessage ($text: String!) {
    sendMessage (text: $text) {
      id
      text
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  variables<span class="token operator">:</span> <span class="token punctuation">{</span>
    text<span class="token operator">:</span> newMessage<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">cache<span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token punctuation">{</span> sendMessage <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">readQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query<span class="token operator">:</span> <span class="token constant">MESSAGES</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    data<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sendMessage<span class="token punctuation">)</span>
    cache<span class="token punctuation">.</span><span class="token function">writeQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query<span class="token operator">:</span> <span class="token constant">MESSAGES</span><span class="token punctuation">,</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>The <code>update</code> function gets a <code>cache</code> object representing the Apollo Client cache. It provides the <code>readQuery</code> and <code>writeQuery</code> function that enable you to execute GraphQL operations on the cache and modify the expected result.</p> <p>The 2nd argument is an object containing the data from the mutation result. This should be used to modify the cached data and write it back with <code>cache.writeQuery</code>.</p> <p>After the <code>update</code> function is called, the components whose data has been changed in the cache will automatically re-render. In our example, the list of messages will automatically update with the new message received from the mutation result.</p> <p>Alternatively, we can pass an <code>update</code> function within the second parameter when calling the <code>mutate</code>  function:</p> <div class="language-js extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br></div><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  mutation sendMessage ($text: String!) {
    sendMessage (text: $text) {
      id
      text
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token function">sendMessage</span><span class="token punctuation">(</span>
  <span class="token punctuation">{</span>
    text<span class="token operator">:</span> text<span class="token punctuation">.</span>value
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">cache<span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token punctuation">{</span> sendMessage <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> data <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">readQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query<span class="token operator">:</span> <span class="token constant">MESSAGES</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      data<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sendMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
      cache<span class="token punctuation">.</span><span class="token function">writeQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query<span class="token operator">:</span> <span class="token constant">MESSAGES</span><span class="token punctuation">,</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="mutation-state"><a href="#mutation-state" class="header-anchor">#</a> Mutation state</h2> <h3 id="loading"><a href="#loading" class="header-anchor">#</a> Loading</h3> <p>Use the <code>loading</code> ref returned from <code>useMutation</code> to track if the mutation is in progress:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage<span class="token punctuation">,</span> loading<span class="token operator">:</span> sendMessageLoading <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  mutation sendMessage ($text: String!) {
    sendMessage (text: $text) {
      id
      text
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre></div><p>It's generally a good idea to rename it (here to <code>sendMessageLoading</code>).</p> <h3 id="error"><a href="#error" class="header-anchor">#</a> Error</h3> <p>Track if any error occured during the mutation with the <code>error</code> ref:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage<span class="token punctuation">,</span> error<span class="token operator">:</span> sendMessageError <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  mutation sendMessage ($text: String!) {
    sendMessage (text: $text) {
      id
      text
    }
  }
</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
</code></pre></div><h2 id="event-hooks"><a href="#event-hooks" class="header-anchor">#</a> Event hooks</h2> <h3 id="ondone"><a href="#ondone" class="header-anchor">#</a> onDone</h3> <p>This is called when the mutation successfully completes.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> onDone <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>

<span class="token function">onDone</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>In our example, this is very useful for resetting the message input:</p> <div class="language-vue extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><br><br><br><br><br><br><br><br><br></div><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span> useQuery<span class="token punctuation">,</span> useResult<span class="token punctuation">,</span> useMutation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/apollo-composable'</span>
<span class="token keyword">import</span> gql <span class="token keyword">from</span> <span class="token string">'graphql-tag'</span>

<span class="token keyword">const</span> <span class="token constant">MESSAGES</span> <span class="token operator">=</span> gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
  query getMessages {
    messages {
      id
      text
    }
  }
</span><span class="token template-punctuation string">`</span></span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">setup</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Messages list</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> result <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useQuery</span><span class="token punctuation">(</span><span class="token constant">MESSAGES</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> messages <span class="token operator">=</span> <span class="token function">useResult</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment">// Send a new message</span>
    <span class="token keyword">const</span> newMessage <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> mutate<span class="token operator">:</span> sendMessage<span class="token punctuation">,</span> onDone <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span>gql<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      mutation sendMessage ($text: String!) {
        sendMessage (text: $text) {
          id
          text
        }
      }
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
      variables<span class="token operator">:</span> <span class="token punctuation">{</span>
        text<span class="token operator">:</span> newMessage<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">update</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">cache<span class="token punctuation">,</span> <span class="token punctuation">{</span> data<span class="token operator">:</span> <span class="token punctuation">{</span> sendMessage <span class="token punctuation">}</span> <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> data <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">readQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query<span class="token operator">:</span> <span class="token constant">MESSAGES</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        data<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sendMessage<span class="token punctuation">)</span>
        cache<span class="token punctuation">.</span><span class="token function">writeQuery</span><span class="token punctuation">(</span><span class="token punctuation">{</span> query<span class="token operator">:</span> <span class="token constant">MESSAGES</span><span class="token punctuation">,</span> data <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token function">onDone</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      newMessage<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      messages<span class="token punctuation">,</span>
      newMessage<span class="token punctuation">,</span>
      sendMessage<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>newMessage<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@keyup.enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sendMessage()<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>messages<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message of messages<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>message.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        {{ message.text }}
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="onerror"><a href="#onerror" class="header-anchor">#</a> onError</h3> <p>This is triggered when an error occurs during the mutation.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> logErrorMessages <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/apollo-util'</span>

<span class="token keyword">const</span> <span class="token punctuation">{</span> onError <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMutation</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>

<span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">logErrorMessages</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/Akryum/vue-apollo/edit/v4/packages/docs/src/guide-composable/mutation.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/10/2021, 5:47:58 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide-composable/query.html" class="prev">
        Queries
      </a></span> <span class="next"><a href="/guide-composable/subscription.html">
        Subscriptions
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.d6060d8c.js" defer></script><script src="/assets/js/2.d347fc36.js" defer></script><script src="/assets/js/38.9bfe8e62.js" defer></script><script src="/assets/js/4.3bfcd1eb.js" defer></script>
  </body>
</html>
